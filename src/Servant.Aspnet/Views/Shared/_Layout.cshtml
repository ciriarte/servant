@using Servant.Business.Objects
@using Servant.Manager.Modules
@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<dynamic>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>@Model.Title</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
    <link href="/css/base.css" rel="stylesheet" type="text/css" />
</head>
    <body>
        <div id="popup-message" class="error">
            <span>@Model.Message</span>
        </div>

        <div id="sidemenu">
            <div id="servername">
                \\@Model.Page.Servername
            </div>
            
            <form id="search" action="/search/" method="GET">
                <input type="text" class="white" style="float:left;" />
                <input type="submit" value=""  />
            </form>
            
            <ul>
                <li class="home"><a href="/">Home</a></li>
                <li class="sites">
                    <a href="#">Sites<span class="arrow"></span></a>
                    
                    <ul>
                        <li class="bold"><a href="/sites/create">Create new</a></li> 
                        @foreach (Site site in Model.Page.Sites)
                        {
                            <li><a href="/sites/@site.IisId/settings/">@site.Name</a></li>     
                        }
                    </ul>
                </li>
                <li class="settings"><a href="/settings/">Settings</a></li>
            </ul>

        </div>
        <div id="maincontent">
            <div id="content-minwidth">
                @RenderBody()
            </div>
        </div>
    </body>
    
    <script src="/scripts/jquery-1.8.0.min.js" type="text/javascript"></script>
    <script src="/scripts/jquery.uitablefilter.js" type="text/javascript"></script>
    <script src="/scripts/jquery.watermark.min.js"></script>
    <script src="/scripts/base.js" type="text/javascript"></script>
    <script type="text/javascript">
        var errors = @Html.Raw(Model.ErrorsAsJson);
        var message = "@Html.Raw(Model.Message)";
    </script>
    <script type="text/javascript">
        //var uvOptions = {};
        //(function() {
        //    var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
        //    uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/ntkZvVjd0zcNeUeKbxKL8Q.js';
        //    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
        //})();

        $(function() {
            var $searchTextbox = $("#search input[type=text]");
            $searchTextbox.watermark("Search");
            var $popupMessage = $('#popup-message');

            @if (!string.IsNullOrWhiteSpace(Model.Message))
            {
                @:$popupMessage.removeClass().addClass('@Model.MessageType.ToString().ToLower()')
                @:$popupMessage.delay(200).slideDown();    
            }

            $("body").keydown(function(e) {
                var activeElement = $(document.activeElement);
                
                if (!activeElement.is(':input')) {
                    if (e.keyCode === 40) {
                        console.log($("#submenu ul li a"));
                        $("#submenu ul li a").focus();
                    } else {
                        $searchTextbox.focus();
                    }
                }
            });

            $("#popup-message").click(function() {
                $(this).slideUp();
            });

            $("#sidemenu > ul > li").click(function() {
                var $a = $(this).find('a:first');
                var $selectedSubUl = $(this).find("ul");
                
                if (!$a.hasClass('active')) { // Lukker andre
                    var $allSubUls = $("#sidemenu > ul > li > ul");
                    $allSubUls.slideUp(function() {
                        $a.addClass("active");
                        $selectedSubUl.slideDown("fast");    
                    });
                } else {
                    $selectedSubUl.slideUp();
                    $a.removeClass("active");
                }
                
                
            });
        });
    </script>
    <script type="text/javascript">
        var uvOptions = {};
        (function() {
            var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
            uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/ntkZvVjd0zcNeUeKbxKL8Q.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
        })();
    </script>
    @RenderSection("javascript", false)
</html>
